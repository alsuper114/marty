---
layout: docs
title: HTTP API
description: How you communicate with the server
id: http-api
group: docs
header_colour: D9544D
order: 5
---

It's likely at some point that you will need to communicate with the server. HTTP APIs encapsulate that communication for you.

HTTP APIs allow you to define functions that create HTTP requests. Internally we are using [reqwest](https://github.com/ded/reqwest) so anything you can do [reqwest](https://github.com/ded/reqwest#api) you can do with HTTP APIS.

All requests return a promise (Promises/A) that allow you to easily define what happens when a request has finished.

{% highlight js %}
var UsersAPI = Marty.createHttpAPI({
  baseUrl: 'http://foo.com'
  getAll: function (users) {
    return this.get('/users').then(function (res) {
      UserActionCreators.receiveAll(res.content);
    });
  },
  createUser: function (user) {
    this.post({ url: '/users', data: user })
        .then(function (res) {
          UserActionCreators.receiveUser(res.content);
        });
  }
});
{% endhighlight %}

One scenario to consider is what happens if an HTTP request fails. It's already possible to [rollback changes to stores](/docs/stores.html#rollback) so the recommend approach is to pass the rollback function through to the API call so that it can be invoked if an error occurs.

{% highlight js %}
var UsersAPI = Marty.createHttpAPI({
  createUser: function (user, rollback) {
    this.post({ url: '/users', data: user })
        .catch(rollback);
  }
});

var UserActions = Marty.createActionCreators({
  createUser: function (user) {
    var action = this.dispatch('ADD_USER', user);

    UsersAPI.createUser(user, action.rollback);
  }
})
{% endhighlight %}

<h2 id="api">API</h2>

<h3 id="createHttpAPI">createHttpAPI(props)</h3>

To create a new HTTP API, you call <code>Marty.createHttpAPI</code> passing in a set of properties. It returns your HTTP API as a singleton.

{% highlight js %}
var UsersAPI = Marty.createHttpAPI({
  createUser: function (user) {
    this.post({ url: '/users', data: user })
        .then(function (res) {
          UserActionCreators.receiveUser(res.content);
        });
  }
});
{% endhighlight %}

<h3 id="name">name</h3>

An (optional) display name for the HTTP API. Used for richer debugging.

<h3 id="baseUrl">baseUrl</h3>

An (optional) base url to prepend to any urls.

<h3 id="requestOptions">request(options)</h3>

Starts an HTTP request with the given <code>method</code> and <code>options</code>. By default we used [reqwest](https://github.com/ded/reqwest) so the options available to you are

  * `url` a fully qualified uri
  * `method` http method (default: `GET`)
  * `headers` http headers (default: `{}`)
  * `data` entity body for `PATCH`, `POST` and `PUT` requests. Must be a query `String` or `JSON` object
  * `type` a string enum. `html`, `xml`, `json`, or `jsonp`. Default is inferred by resource extension. Eg: `.json` will set `type` to `json`. `.xml` to `xml` etc.
  * `contentType` sets the `Content-Type` of the request. Eg: `application/json`
  * `crossOrigin` for cross-origin requests for browsers that support this feature.
  * `success` A function called when the request successfully completes
  * `error` A function called when the request fails.
  * `complete` A function called whether the request is a success or failure. Always called when complete.
  * `jsonpCallback` Specify the callback function name for a `JSONP` request. This value will be used instead of the random (but recommended) name automatically generated by reqwest.

If you'd prefer to use a different implementation you can just override this method. The only requirement is it returns a <code>Promise</code>.

{% highlight js %}
var UsersAPI = Marty.createHttpAPI({
  createUser: function (user) {
    this.request('POST', {
      url: '/users',
      data: { name: 'foo' }
    });
  }
});
{% endhighlight %}

<h3 id="getUrl">get(url)</h3>

Same as <code>request({ method: 'GET', url: url })</code>

<h3 id="getOptions">get(options)</h3>

Same as <code>request(_.extend(options, { method: 'GET'})</code>

<h3 id="postUrl">post(url)</h3>

Same as <code>request({ method: 'POST', url: url })</code>

<h3 id="postOptions">post(options)</h3>

Same as <code>request(_.extend(options, { method: 'POST'})</code>

<h3 id="putUrl">put(url)</h3>

Same as <code>request({ method: 'PUT', url: url })</code>

<h3 id="putOptions">put(options)</h3>

Same as <code>request(_.extend(options, { method: 'PUT'})</code>

<h3 id="deleteUrl">delete(url)</h3>

Same as <code>request({ method: 'DELETE', url: url })</code>

<h3 id="deleteOptions">delete(options)</h3>

Same as <code>request(_.extend(options, { method: 'DELETE'})</code>